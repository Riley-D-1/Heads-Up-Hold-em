<!DOCTYPE html>
<html lang = "en">
<head>
    <meta name = "viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <link rel = "stylesheet" href = "style.css">
</head>
<body>
	<canvas id="game_window" width="640" height="360"></canvas>
	<div id="menu_buttons">
		<button id = "start_button" onclick="draw_rules_popup()">Start</button>
		<button id= "quit_button" onclick="quit_game()">Quit</button>
		<button id="understand_rules" onclick="game_loop()">I understand all the rules and am ready to play</button>
	</div>
	<div id = "bet_buttons">
		<button id="bet" onclick="bet()">Bet</button>
	</div>
	<script>
		const canvas = document.getElementById("game_window")
		const ctx = canvas.getContext("2d")
		canvas.width = window.innerWidth
		canvas.height = window.innerHeight
		class bot{
			constructor(name,money,difficulty){
				this.name = name;
				this.money = money;
				this.difficulty = difficulty
			}
			get_money(){
				return this.money
			}
			get_name(){
				return this.name
			}
			flip_own_coins(){
				this.priv_coins = Coin_Flip(2)
			}
			gamble(curr_bet){
				let risk_lvl = Math.floor(difficulty*10)
				this.difficulty = Math.random()
				if (this.priv_coins === "hh" ||this.priv_coins === "tt"){
					if (money > curr_bet){
						return "bet"
					}
				}else{
					if (risk_lvl < 5) {
						return "fold";
					} else {
						if (money >curr_bet){
							return "bet";
						}else{
							return "fold";
						}
					}
				}	
			}	
			
			buyin_pay(buyin_cost){
				if (this.money > buyin_cost){
					this.money = this.money - buyin_cost
					return `${this.name} paid`
					
				}
				else{
					//KILL Bot instance and leave table
					bot_leave_anim()
					clearInterval(); 
					alert(`${this.name} ran out of money and left the table`)
				}
			}	
		}
		function bot_leave_anim(){
			console.log("filler")
		}

        function Coin_Flip(count){
			// this is done :)
			let temp_flipped_coins = []
			for (let i= 0; i < count; i++){
				let rand_num = Math.random();
				if (rand_num <= 0.5){
					temp_flipped_coins.push("h")
				}
				else{
					temp_flipped_coins.push("t")
				}
			}
			return temp_flipped_coins
        }

		function name_gen(num_of_names){
			// This one is done too
			// got a big ass list of random names and put some  fun ones in 
			const names = [
			"Liam", "Emma", "Noah", "Olivia", "Ava", "Elijah", "Sophia", "Lucas", "Isabella", "Mason",
			"Mia", "Ethan", "Charlotte", "Logan", "Amelia", "James", "Harper", "Benjamin", "Evelyn", "Jacob",
			"Abigail", "Michael", "Ella", "Alexander", "Scarlett", "Henry", "Grace", "Jackson", "Chloe", "Sebastian",
			"Luna", "Aiden", "Layla", "Matthew", "Aria", "Samuel", "Zoey", "David", "Nora", "Joseph",
			"Levi", "Hazel", "Owen", "Lily", "Wyatt", "Ellie", "John", "Aurora", "Daniel",
			"Gabriel", "Penelope", "Carter", "Victoria", "Jayden", "Hannah", "Luke", "Stella", "Anthony",
			"Isaac", "Savannah", "Grayson", "Brooklyn", "Julian", "Bella", "Lincoln", "Claire", "Nathan", "Skylar",
			"Christian", "Lucy", "Hunter", "Anna", "Connor", "Violet", "Aaron", "Charles", "Alice",
			// Weird but cool names
			"Blade", "Shadow", "Nova", "Onyx", "Echo", "Genesis"
			];
			const shuffled = names.sort(() => 0.5 - Math.random());
			return shuffled.slice(0, num_of_names);
		}

		function start_game(player_count,buyin_cost){
			//fix me
			if (localStorage.getItem('Money') === null){
				console.log("Money reset to default amount")
				localStorage.setItem("Money", 200);
				console.log(localStorage.getItem('Money'))
			}else if(localStorage.getItem('Money') < 6){
				alert("Hey, you ran out of money. Lucky its not real money! You're reset to 200 Money")
				localStorage.setItem("Money", 200)
			}
			else{
				console.log(localStorage.getItem('Money'))
			}
			let player_money = localStorage.getItem('Money')
			if (localStorage.getItem('Money')> buyin_cost){
				localStorage.setItem('Money',player_money - buyin_cost) 
				console.log(localStorage.getItem('Money'))
			}
			bot_names = name_gen(player_count)
			let bot_list = []
			console.log(player_count)
			for (let i = 0; i < player_count; i++){
				let temp_bot = new bot(bot_names[i],200,Math.random())
				bot_list.push(temp_bot)
			}
			return bot_list	
		}
		function quit_game(){
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			window.location.href = 'index.html';
		}
		function hand_check(hand){
			const heads_count = hand.filter(item => item === "h").length;
			const tails_count = hand.filter(item => item === "t").length;
			console.log(tails_count)
			console.log(heads_count)
			if (heads_count === tails_count){
				return "split"
			}else if (heads_count === 4|| tails_count ===4){
				return "Quad"
			} else if (heads_count === 5|| tails_count === 5){
				return "Five Frenzy"
			} else if (heads_count === 6||tails_count === 6 ){
				return "Flipstorm"
			}
			else{
				return "Error, not valid handtype just yet"
			}
		}
		function tie_break(tied_players,pot){
			let head_count_to_beat = -1
			tied_players.forEach(element => {
				let heads_count_tie = hand.filter(item => item === "h").length;
				if (heads_count_tie < head_count_to_beat){
					best_players.push(element)
					head_count_to_beat = heads_count_tie 
				}
			});
			best_players.forEach(element => {
				if (bot){
					botname.pay(element,(pot/best_players.length))
				}
			});
		}
		function gamble(players){
			const bet_amount = floor(Math.random()*10)
			players.forEach(element => {
				bot_instance.gamble(bet_amount)
			}); 

		}
		function pay()
		function draw_main_menu(){
			understand_rules.style.display = 'none';
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			const backgroundImage = new Image();
    		backgroundImage.src = 'assets/menu.png';
			backgroundImage.onload = function() {
				ctx.drawImage(backgroundImage,0, 0, canvas.width, canvas.height );
			};
		}
		function draw_rules_popup(){
			// Done i think
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			start_button.style.display = 'none';
			quit_button.style.display = 'none';
			understand_rules.style.display = 'block';
			ctx.fillStyle = '#497425'
			ctx.fillRect(0, 0, canvas.width, canvas.height); 
			ctx.font = '50px Pixelify Sans'
			ctx.fillStyle = '#f7ba47'
			ctx.textAlign = "center"
			ctx.fillText("Rules for Heads Up Hold'em", canvas.width / 2, 120);
			ctx.font = '20px Pixelify Sans'
			const rules = [
			"There are 4 different hand types, ordered from worst to best:",
			"1. Split (3 of each)",
			"2. Quad (4 of the same type)",
			"3. Five Frenzy (5 of the same type)",
			"4. Flip Storm (6 of the same type)",
			"Gameplay Rules",
			"- Player pays the buy-in fee (Costs 6 Money atm)",
			"- Each player flips their 2 private coins.",
			"- Dealer is randomly selected.",
			"- A betting round occurs (starting on the dealer). In a clockwise order players can  bet or fold. (Players must all match the bet or can fold)",
			"- The dealer flips 4 community coins.",
			"- Count your heads and tails and use your highest number.",
			"- All personal coins are revealed. The player with the best hand type wins. (If players tie on a hand, heads triumph over tails. If there is still a tie, the pot is split equally.)"
			];
			ctx.textAlign = "left"
			rules.forEach((rule, i) => {
				ctx.fillText(rule, 10, 180 + i * 30);
			});
			console.log("drawn instructions popup")
			console.log(200/Math.random()*Math.random())

		}

		function draw_game(){
			// MAjor work needed
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			start_button.style.display = 'none';
			quit_button.style.display = 'none';
			understand_rules.style.display = 'none';
			ctx.fillStyle = '#497425'
			ctx.fillRect(0, 0, canvas.width, canvas.height); 
			ctx.font = '20px Pixelify Sans'
			ctx.fillStyle = '#f7ba47'
			const payin_coins = "pixel_asets/payin_coins.png"
			payin_coins.onload = function() {
				ctx.drawImage(payin_coins,0, 0, canvas.width, canvas.height );
			};
			// Need to add coin counter in top left
			// Need to add bet counter
			// Best hand atm thing (to make it easier for new players)
			console.log(" drawn")

		}
		//function anim_flip(vaule,my_hand){
		//	console.log(vaule)
		//	if (vaule === own){
		//		the
		//	}
		//}
		function game_loop(){
			// game logic fix needed
			const audio = new Audio('music/Get_After_It.ogg');
			audio.play()
			console.log(start_game(3,6))
			console.log("test of game loop")
			draw_game();
			//	draw_game();
			//	console.log("test2")
			//}

			let my_hand = (Coin_Flip(2))
			//anim_flip("my_hand")
			console.log(my_hand)
			//betting function
			const community_coins = Coin_Flip(4)
			//anim flip community coins_first
			console.log(community_coins)
		}
		window.onload = function(){
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			draw_main_menu()
			

		}

    </script>
</body>
</html>
